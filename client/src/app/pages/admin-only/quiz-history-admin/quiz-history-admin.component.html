<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <img src="assets/logo.png" />
    </div>
    <ul class="sidebar-menu">
      <li class="sidebar-item">
        <a [routerLink]="['/home']">🏠 Home </a>
      </li>
      <li class="sidebar-item">
        <a [routerLink]="['/quiz-edit-admin']">🏠 Manage Quiz </a>
      </li>
      <li class="sidebar-item">
        <a [routerLink]="['/quiz-history-admin']" routerLinkActive="active"
        >📝 Review
        </a>
      </li>
    </ul>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="content-top">
      <div class="header-left">
        <div class="user-info">
          <img src="./assets/admin.jpg" alt="Admin" class="rounded-full">
          <span>ADMIN</span>
        </div>

        <div class="date" (click)="toggleDateFilter()">
          <button class="date-btn" type="button">
            <div class="date-calender">
              <span class="material-symbols-outlined calendar-icon">calendar_today</span>
              {{ currentDate | date:'d MMM' }}
            </div>
          </button>

          <!-- Popup lịch -->
          <div class="date-filter-popup" *ngIf="showDateFilter" (click)="$event.stopPropagation()">
            <div class="calendar-header">
              <div class="button-background">
                <button class="nav-btn" (click)="previousMonth()">&lt;</button>
              </div>
              <span class="month-year">{{ calendarMonth | date:'MMMM yyyy' }}</span>
              <div class="button-background">
                <button class="nav-btn" (click)="nextMonth()">&gt;</button>
              </div>
            </div>
            <div class="calendar-grid">
              <div class="weekday" *ngFor="let day of ['Mo', 'Tu', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']">{{ day }}</div>
              <div class="day" *ngFor="let day of calendarDays"
                   [class.selected]="day.isSelected"
                   [class.disabled]="!day.isCurrentMonth"
                   [class.today]="day.isToday"
                   (click)="selectDay(day)">
                <span class="crown" *ngIf="day.isToday">👑</span>
                {{ day.day }}
              </div>
            </div>
            <button class="clear-btn" (click)="clearDate()">Clear Date</button>
          </div>
          </div>

          <div class="overlay" *ngIf="showDateFilter" (click)="closeDateFilter()"></div>
        </div>


      <div class="header-right">
        <input type="text" placeholder="Search" class="search-bar">
        <button class="notification-btn">
          <i class="fas fa-bell"></i>
          <span class="notification-count">1</span>
        </button>
      </div>
    </header>

    <!-- Quiz Content -->
    <section class="content-bot">
      <!-- Quiz Table -->
      <ng-container *ngIf="paginatedQuizzes.length > 0; else noQuiz">
        <table class="quiz-table">
          <thead>
          <tr class="table-header">
            <th class="table-cell">ID</th>
            <th class="table-cell">Title</th>
            <th class="table-cell">Date Created</th>
            <th class="table-cell">Participants</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let quiz of paginatedQuizzes" class="table-row">
            <td class="table-cell text-center">{{ quiz.id }}</td>
            <td class="table-cell">{{ quiz.title }}</td>
            <td class="table-cell text-center">{{ quiz.createdAt | date:'dd/MM/yyyy' }}</td>
            <td class="table-cell text-center">
              <button class="participant-btn" (click)="quiz.showParticipants = !quiz.showParticipants">
                {{ quiz.participants.length }}
              </button>

              <div *ngIf="quiz.showParticipants" class="participant-list">
                <ng-container *ngIf="quiz.participants.length > 0; else noParticipants">
                  <ul>
                    <li *ngFor="let p of quiz.participants" class="participant-item">
                      - {{ p.name }} ({{ p.submittedAt | date:'shortTime' }})
                    </li>
                  </ul>
                </ng-container>
              </div>
            </td>
          </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <nav class="pagination">
          <button class="pagination-btn" [disabled]="currentPage === 1" (click)="previousPage()">
            Previous
          </button>
          <span class="pagination-info">Page {{ currentPage }} of {{ totalPages }}</span>
          <button class="pagination-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
            Next
          </button>
        </nav>
      </ng-container>
    </section>
  </main>
</div>

<!-- Templates -->
<ng-template #noParticipants>
  <p class="no-participant-text">No participants yet</p>
</ng-template>

<ng-template #noQuiz>
  <p class="no-quiz-text">
    {{ selectedDate ? 'No quizzes found on ' + (selectedDate | date:'dd/MM/yyyy') : 'No quizzes available.' }}
  </p>
</ng-template>
